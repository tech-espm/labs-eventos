
<div class="row">
	<div class="col-lg-12" id="content"></div>
</div>

<div class="modal fade" tabindex="-1" role="dialog" id="modalQR">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Fechar" id="btnModalFechar"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title">Código QR</h4>
			</div>
			<div class="modal-body text-center">
				<div id="qrcode"></div>
				<div class="form-group">
					<small>Apresente este código a partir da tela do seu celular para acessar as sessões dos eventos.<br /><br /><a id="linkQR" href="/participante/qr" target="_blank"><i class="fa fa-print"></i> Se preferir, clique aqui para gerar uma versão do código para impressão.</a></small>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-outline btn-default" data-dismiss="modal">Fechar</button>
			</div>
		</div>
	</div>
</div>

<%- contentFor("styles") %>
<style type="text/css">
	.panel {
		background-color: transparent;
	}

	.panel-body {
		background-color: #fff;
	}

	.panel-default > .panel-heading {
		background-color: rgba(255,255,255,0.85);
		font-size: 25px;
	}

		.panel-default > .panel-heading::first-letter {
			font-size: 40px;
		}

	#qrcode > img {
		display: block;
		margin: 15px auto 30px;
		width: 100%;
		max-width: 200px;
	}
</style>

<%- contentFor("scripts") %>
<script type="text/javascript" src="/lib/qrcodejs/js/qrcode-1.0.0.min.js"></script>
<script type="text/javascript">
	//<![CDATA[
	"use strict";

	var eventos = <%- eventos %>, qrcode = null;

	function mostrarQR() {
		if (!qrcode) {
			qrcode = new QRCode("qrcode", {
				text: "<%- participante.id %>",
				width: 400,
				height: 400,
				colorDark: "#000000",
				colorLight: "#ffffff",
				correctLevel: QRCode.CorrectLevel.H
			});
			$("#qrcode").attr("title", "");
		}

		$("#modalQR").modal({
			backdrop: "static",
			keyboard: false
		});
	}

	(function () {
		var i, evento, html = '<div class="row"><div class="col-lg-12"><div class="panel panel-default"><div class="panel-body"><button type="button" onclick="mostrarQR()" class="btn btn-lg btn-outline btn-default btn-block"><i class="fa fa-qrcode"></i> Código QR para presença</button></div></div></div></div>';

		eventos.sort(function (a, b) { return b.data - a.data; });
		eventos[1] = eventos[0];
		eventos[2] = eventos[0];
		eventos[3] = eventos[0];

		for (i = 0; i < eventos.length; i++) {
			evento = eventos[i];
			evento.data = 201906;
			evento.data = months[evento.data % 100].substr(1) + ((evento.data / 100) | 0);

			if (!(i & 1))
				html += (i ? '</div><div class="row">' : '<div class="row">');

			html += '<div class="';
			// A última coluna de uma lista com quantidade ímpar deve ocupar todo o espaço
			html += ((i === (eventos.length - 1) && (eventos.length & 1)) ? "col-lg-12" : "col-sm-6");
			html += '"><div class="panel panel-default"><div class="panel-heading">' + encode(evento.nome) + '</div><div class="panel-body no-bottom">';
			html += '<h4 class="text-right"><i class="fa fa-calendar"></i> ' + evento.data + '</h4>';
			html += '<div class="form-group"><button type="button" onclick="mostrarEvento(' + evento.id + ')" class="btn btn-lg btn-outline btn-default btn-block"><i class="fa fa-edit"></i> Minhas inscrições</button></div>';
			html += '<div class="form-group"><a class="btn btn-lg btn-outline btn-default btn-block" href="/' + evento.url + '" target="_blank"><i class="fa fa-external-link"></i> Página do evento</a></div>';
			html += '</div></div></div>';
		}

		html += '</div>';

		$("#content").html(html);
	})();

	//]]>
</script>
