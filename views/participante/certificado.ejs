<%
	function format2(x) {
		return ((x < 10) ? ("0" + x) : x);
	}

	var duracaoTotal = 0, meses = ["janeiro","fevereiro","março","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"], linhaData = "São Paulo, ";

	(function () {
		var i, presenca, partes, inicio, termino, duracao;

		if (presencas[0].data) {
			for (i = 0; i < presencas.length; i++) {
				partes = presencas[i].data.split('/');
				presencas[i].dia = parseInt(partes[0], 10);
				presencas[i].mes = parseInt(partes[1], 10);
				presencas[i].ano = parseInt(partes[2], 10);
			}
		}

		presencas.sort(function (a, b) {
			if (a.ano !== b.ano)
				return a.ano - b.ano;
			if (a.mes !== b.mes)
				return a.mes - b.mes;
			if (a.dia !== b.dia)
				return a.dia - b.dia;
			return a.ordem - b.ordem;
		});

		presenca = presencas[presencas.length - 1];
		linhaData += presenca.dia + " de " + meses[presenca.mes - 1] + " de " + presenca.ano;

		for (i = 0; i < presencas.length; i++) {
			presenca = presencas[i];

			duracao = 0;

			partes = presenca.inicio.split(":");
			if (partes.length === 2) {
				inicio = (parseInt(partes[0]) * 60) + parseInt(partes[1]);
				if (!isNaN(inicio)) {
					partes = presenca.termino.split(":");
					if (partes.length === 2) {
						termino = (parseInt(partes[0]) * 60) + parseInt(partes[1]);
						if (!isNaN(termino) && termino > inicio)
							duracao = (termino - inicio) / 60;
					}
				}
			}

			presenca.duracao = duracao;

			duracaoTotal += duracao;
		}

		// Para poder mostrar hora(s) sem problemas de arredondamento
		duracaoTotal = parseFloat(duracaoTotal.toFixed(1));
	})();

%>

<section class="sheet text-center">

	<img src="/evt/<%-evento.id %>/fundo-certificado.png?v=<%-evento.versao %>" style="position: absolute; width: 100%; height: 100%; left: 0; top: 0; pointer-events: none; z-index: 0;" />

	<div style="position: absolute; width: 100%; height: 100%; left: 0; top: 0; z-index: 1;">
		<p style="margin: 70mm 0 0;">Certificamos que</p>

		<p style="margin: 5mm 10mm 0; font-size: 10mm; font-weight: 700; color: #a70230 !important; -webkit-print-color-adjust: exact;"><%=participante.nome %></p>

		<p style="margin: 5mm 10mm 0;">(sob o e-mail <b><%=participante.email %></b>) <%-(palestrante ? "ministrou as" : "participou das") %> sessões descritas na página seguinte, com uma carga horária total de <b><%-(duracaoTotal.toFixed(1).replace(".", ",") + (duracaoTotal === 1 ? " hora" : " horas")) %></b>, nos respectivos dias e horários, como parte do evento <b><%=evento.nome %></b>.</p>

		<p style="margin: 10mm 10mm 0;"><%-linhaData %>.</p>
	</div>

	<div class="branco" style="position: absolute; left: 3mm; bottom: 3mm; font-size: 3mm; z-index: 2; text-align: left;">
		<span class="branco no-print">
			Você pode <a class="branco" style="text-decoration: underline; font-weight: 700;" href="#" onclick="window.print(); return false;"><i class="fa fa-print"></i>imprimir</a> o certificado, ou compartilhar o link abaixo:
		</span>
		<span class="branco print-only">
			Link para verificação de autenticidade do certificado:
		</span>
		<br />
		credenciamento.espm.br/<%-(palestrante ? "evento" : "participante") %>/certificado/<%-idcertificado %>
	</div>

</section>

<section class="sheet padding-10mm" style="font-size: 3.5mm;">

	<table class="table table-hover">
		<thead>
			<tr>
				<th class="text-left">Sessão</th>
				<th class="col-min text-center">Data</th>
				<th class="col-min text-center">Início</th>
				<th class="col-min text-center">Término</th>
				<th class="col-min text-center">Duração (h)</th>
				<% if (!palestrante) { %>
				<th class="col-min text-center">ACOM</th>
				<% } %>
			</tr>
		</thead>
		<tbody>
			<% var totalAcom = 0; for (var i = 0; i < presencas.length; i++) { var presenca = presencas[i]; if (presenca.permiteacom) { totalAcom += presenca.duracao; } %>
			<tr>
				<td class="text-left"><%=presenca.nome %></td>
				<td class="col-min text-center"><%-(presenca.data || (format2(presenca.dia) + "/" + format2(presenca.mes) + "/" + presenca.ano)) %></td>
				<td class="col-min text-center"><%=presenca.inicio %></td>
				<td class="col-min text-center"><%=presenca.termino %></td>
				<td class="col-min text-center"><%-(presenca.duracao.toFixed(1).replace(".", ",")) %></td>
				<% if (!palestrante) { %>
				<td class="col-min text-center"><%-(presenca.permiteacom ? "SIM" : "NÃO") %></td>
				<% } %>
			</tr>
			<% } %>
			<% if (!palestrante) { %>
			<tr>
				<td colspan="6" class="text-right"><b>Total de horas ACOM:</b> <%-(totalAcom.toFixed(1).replace(".", ",")) %> h</td>
			</tr>
			<% } %>
		</tbody>
	</table>

</section>

<%- contentFor("styles") %>
<link href="https://fonts.googleapis.com/css?family=PT+Sans:400,700&display=swap&subset=latin-ext" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="/lib/paper-css/css/paper.min.css" />
<style type="text/css">
	body {
		font-family: 'PT Sans', sans-serif;
		font-size: 6mm;
		font-weight: 400;
		color: #000;
	}

	/* https://developer.mozilla.org/en-US/docs/Web/CSS/@page */
	@page {
		size: A4 landscape;
	}

	.print-only {
		display: none;
	}

	@media print {
		.no-print {
			display: none;
		}

		.print-only {
			display: inline;
		}
	}

	.branco {
		color: #fff !important;
		-webkit-print-color-adjust: exact !important;
		color-adjust: exact !important;
	}
</style>

<%- contentFor("scripts") %>
<script type="text/javascript">
	//<![CDATA[
	"use strict";

	document.body.className = "A4 landscape";

	/*
	var presencas = <%- presencas %>;

	(function () {
		var i, presenca, partes, inicio, termino, duracao, duracaoTotal = 0, html = "";

		presencas.sort(function (a, b) {
			if (a.ano !== b.ano)
				return a.ano - b.ano;
			if (a.mes !== b.mes)
				return a.mes - b.mes;
			if (a.dia !== b.dia)
				return a.dia - b.dia;
			return a.ordem - b.ordem;
		});

		for (i = 0; i < presencas.length; i++) {
			presenca = presencas[i];

			duracao = 0;

			partes = presenca.inicio.split(":");
			if (partes.length === 2) {
				inicio = (parseInt(partes[0]) * 60) + parseInt(partes[1]);
				if (!isNaN(inicio)) {
					partes = presenca.termino.split(":");
					if (partes.length === 2) {
						termino = (parseInt(partes[0]) * 60) + parseInt(partes[1]);
						if (!isNaN(termino) && termino > inicio)
							duracao = (termino - inicio) / 60;
					}
				}
			}

			html += '<tr><td class="text-left">' + encode(presenca.nome) + '</td>';
			html += '<td class="col-min text-center">' + (presenca.data || (format2(presenca.dia) + "/" + format2(presenca.mes) + "/" + presenca.ano)) + '</td>';
			html += '<td class="col-min text-center">' + presenca.inicio + '</td>';
			html += '<td class="col-min text-center">' + presenca.termino + '</td>';
			html += '<td class="col-min text-center">' + duracao.toFixed(1).replace(".", ",") + '</td></tr>';

			duracaoTotal += duracao;
		}

		// Para poder mostrar hora(s) sem problemas de arredondamento
		duracaoTotal = parseFloat(duracaoTotal.toFixed(1));

		$("#lblHoras").text(duracaoTotal.toFixed(1).replace(".", ",") + (duracaoTotal === 1 ? " hora" : " horas"));
		$("#tabela").html(html);
	})();
	*/
	//]]>
</script>

<!--
<div class="painel-msg">
	<div class="panel panel-default no-margin-bottom">
		<div class="panel-body">
			<div>
				<img alt="ESPM" width="150" src="/imagens/logo.png" />
			</div>
			<h1>Certificado de Participação</h1>
			<p>A ESPM certifica que <b><%=participante.nome %></b> (<b><%=participante.email %></b>) <%-(palestrante ? "ministrou as" : "participou das") %> sessões descritas abaixo, com uma carga horária total de <b id="lblHoras"></b>, nos respectivos dias e horários, como parte do evento <b><%=evento.nome %></b>.</p>
			<div class="table-responsive" style="margin-bottom: 15px;">
				<table class="table table-hover">
					<thead>
						<tr>
							<th class="text-left">Sessão</th>
							<th class="col-min text-center">Data</th>
							<th class="col-min text-center">Início</th>
							<th class="col-min text-center">Término</th>
							<th class="col-min text-center">Duração (h)</th>
						</tr>
					</thead>
					<tbody id="tabela"></tbody>
				</table>
			</div>
			<div>
				<small>
					<span class="no-print">
						Você pode <a href="#" onclick="window.print(); return false;"><i class="fa fa-print"></i>imprimir</a> o certificado, ou compartilhar o link abaixo para verificação de autenticidade do certificado:
					</span>
					<span class="print-only">
						Link para verificação de autenticidade do certificado:
					</span>
					<br />
					credenciamento.espm.br/<%-(palestrante ? "evento" : "participante") %>/certificado/<%-idcertificado %>
				</small>
			</div>
		</div>
	</div>
</div>
-->
